/*! win-behat 01-03-2014 */
angular.module("winbehat",["ui.codemirror"]),angular.module("winbehat").controller("directoryTreeController",["$scope","filelistService","editFilelistService",function(a,b,c){a.filelist={},a.hasFilelist=!1,a.openDirectory=function(c){c.files[0]&&b.read(c.files[0].path,function(b){a.$apply(function(){b&&(a.filelist=b),a.hasFilelist=!0})})},a.clickNode=function(d){d.item.isDirectory?d.item.isOpen?d.item.isShow=!d.item.isShow:b.read(d.item.name,function(b){a.$apply(function(){b&&(d.item.children=b.children),d.item.isOpen=!0,d.item.isShow=!0})}):c.push(d.item.name)},a.getIconClass=function(a){return{"icon-expand-directory":a.item.isDirectory&&a.item.isShow,"icon-contract-directory":a.item.isDirectory&&!a.item.isShow,"icon-file":!a.item.isDirectory,"tree-icon":!0}}}]),angular.module("winbehat").controller("textEditorController",["$scope","codeMirrorService","editFilelistService",function(a,b,c){a.editFilelist=c.list,a.editFileCount=0,a.editFile={},a.codeMirror={},a.editorOptions={lineNumbers:!0,indentUnit:4,indentWithTabs:!1,matchBrackets:!0,autoCloseBrackets:!0,autoCloseTags:!0,styleSelectedText:!0,styleActiveLine:!0,continueComments:!0,mode:"php",extraKeys:{"Ctrl-/":"toggleComment",Tab:b.insertTab,"Ctrl-Space":b.autocomplete,"Ctrl-S":function(){d()}},onLoad:function(b){a.codeMirror=b}},a.$watchCollection("editFilelist",function(b){var c=b.length;c>a.editFileCount&&(a.select(c-1),e()),a.editFileCount=c}),a.isBold=function(a){return{bold:a.text!=a.lastText}},a.select=function(b){var d=a.editFile,e=c.select(b)||{text:""},f=null;d.path!=e.path&&(a.editFile=e,d.text=a.codeMirror.getValue(),d.path&&(d.history=a.codeMirror.getHistory()),a.codeMirror.clearHistory(),a.editFile.history&&a.codeMirror.setHistory(a.editFile.history),f=a.$watch("codeMirror.doc.history",function(){a.codeMirror.doc.history.done.pop(),f()}))},a.remove=function(b){var d=c.remove(b);d.path==a.editFile.path&&a.select(b-1)};var d=function(){a.editFile.save(function(b){b||a.$apply()})},e=function(){a.codeMirror.doc.setValue(a.editFile.text),a.editFile.lastText=a.codeMirror.doc.getValue()}}]),angular.module("winbehat").directive("dirctoryTreeNode",["$compile",function(a){return{restrict:"E",replace:!0,scope:{file:"="},templateUrl:"template/directory-tree-node.html",controller:"directoryTreeController",compile:function(b){var c,d=b.contents().remove();return function(b,e){c||(c=a(d)),c(b,function(a){e.append(a)})}}}}]),angular.module("winbehat").directive("resizeCodeMirror",["$window",function(a){return function(b){var c=document.querySelector("#editor-tabs");b.windowHeight=0,b.windowWidth=0,b.initializeWindowSize=function(){b.windowHeight=a.innerHeight-c.clientHeight,b.windowWidth=a.innerWidth},b.initializeWindowSize(),b.$watchCollection("editFilelist",function(){b.initializeWindowSize()}),angular.element(a).bind("resize",function(){return b.initializeWindowSize(),b.$apply()})}}]),angular.module("winbehat").factory("behatService",function(){return require("./js/my-modules/behat")}),angular.module("winbehat").factory("codeMirrorService",function(){var a=require("./js/my-modules/filename-extension-list"),b=function(a){var b=a.getOption("indentUnit"),c="",d=a.doc.sel,e=d.from,f=d.to,g=0,h=0,i=[],j={line:0,ch:0},k={line:0,ch:0};if(a.somethingSelected()){for(c=Array(b+1).join(" "),j.line=e.line,g=e.line,h=g+a.getSelection().split("\n").length-!f.ch;h>g;g++)i.push(c+a.doc.getLine(g)),k.line=g,k.ch=a.doc.getLine(g).length;a.doc.replaceRange(i.join("\n"),j,k),j.ch=e.ch+b,k.ch=f.ch+b,a.doc.setSelection(j,k)}else c=Array(b-e.ch%b+1).join(" "),a.replaceSelection(c,"end","+input")},c=function(a){CodeMirror.showHint(a,a.getHelper(a.getCursor(),"hint")||CodeMirror.hint.anyword)};CodeMirror.modeURL="js/lib/codemirror/mode/%N/%N.js";var d=function(b,c){CodeMirror.autoLoadMode(b,a[c]),b.setOption("mode",a[c])};return{insertTab:b,autocomplete:c,changeMode:d}}),angular.module("winbehat").factory("editFilelistService",function(){var a=require("fs"),b=[],c=function(c){for(var d=!0,e="",f=0,g=b.length;g>f;f++)if(b[f].path===c){d=!1;break}d&&(e=a.readFileSync(c).toString(),b.push({path:c,name:c.split("\\").pop(),isSelected:!1,text:e,lastText:"",history:null,save:function(b){a.writeFile(this.path,this.text,function(a){return a&&b?void b(a):(this.lastText=this.text,void(b&&b()))}.bind(this))}}))},d=function(a){return b.splice(a,1)[0]},e=function(a){var c=0,d=b.length;for(0>a?a=0:a>=d&&(a=d-1);d>c;c++)b[c].isSelected=!1;return b[a]&&(b[a].isSelected=!0),b[a]};return{list:b,push:c,remove:d,select:e}}),angular.module("winbehat").factory("filelistService",function(){return require("./js/my-modules/filelist")});